# –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª—ë–≥–∫–∏–π –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ Python
FROM python:3.12-slim

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Ö
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# –ö–æ–ø–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –∏ —Ç–µ—Å—Ç
COPY step_orchestrator.py steps.yaml test_steps.py ./

# ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
# –ò—Å–ø–æ–ª—å–∑—É–µ–º "python3 -u" (unbuffered mode) —á—Ç–æ–±—ã –≤—ã–≤–æ–¥ —à–µ–ª —Å—Ä–∞–∑—É
# "set -euxo pipefail" ‚Äî –¥–ª—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ —Å–±–æ—Ä–∫–∏
RUN set -euxo pipefail && \
    echo "üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ task_orchestrator..." && \
    python3 -u test_steps.py && \
    echo "‚úÖ –¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω!"

# ‚è≥ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Å—Ç–∞—ë—Ç—Å—è –∂–∏–≤—ã–º (–¥–ª—è Cline / –æ—Ç–ª–∞–¥–∫–∏)
CMD ["sleep", "infinity"]
